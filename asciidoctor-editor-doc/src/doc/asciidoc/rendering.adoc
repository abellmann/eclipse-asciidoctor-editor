=== Rendering

Why is this so problematic?


==== Preview in HTML and Same origin policy

The generated HTML files do contain
absolute pathes which is not allowed 
in all browsers. So images are not rendered

To handle this, the generated HTML output
is transformed from absolute pathes to relative
ones


==== Generated files problem

Unfortunately the generated diagrams
do appear inside original sources

So it is necessary to set attribute 
`imagesoutdir` .

But the location must be the same as
the normal images directory, because asciidoc
just only accept one imagesdir...

So this must be calculated to real
target image directory in temp folder

==== Temporary files and their long path problems
if we have a long temp folder path (e.g. windows), it
it can be problematic when we copy tmp files/structure

:prefix-calculation: ???sha256???

NOTE: For security reasons it's also better to flat the names, because path traversal is not possible
      (maybe a little bit paranoid but ...)

====== Project folders
The project path is inside the name as a {prefix-calculation}. 
So we can use this flat way, even when project names are same

====== Editor files
To have the possiblity to change output behaviour a hidden editor file is used which
includes the origin asciidoc file from eclipse project structure.

This solves also the base dir problematic (the hidden file location is the base dir)

To handle long path problem the hidden editor files do have a prefix with is `editorId`
which represents the editor instance inside eclipse.

So we can use these files flat inside project, even when filenames are same

===== Images 
There are different kind of images:
- images from project
- generated images by `asciidoctor-diagram`

[IMPORTANT]
====
Unfortunately asciidoctor-diagram output directory does not correlate 100% with imagesdir! 

For more details look at:
https://github.com/asciidoctor/asciidoctor-diagram/issues/110
https://github.com/asciidoctor/asciidoctor-diagram/issues/110#issuecomment-699510148
====

Idea: Instead of copying the file structure we could use ONE image directory and create also
      flat-image-names.
      This will solve also the problem

===== Avoiding Same origin problems with images
To avoid same origin problems the <img src parts inside generated HTML are inspected
and the necessary images are copied.       

===== Output Structure

Example:
  
[source,bash]       
----

/myproject/
    .classpath
    /images2/
        image2.jpg
    /src/doc/asciidoc
        images1/
          image1.jpg
        test1.adoc
        test2.adoc

----       

The asciidoc document `test1.adoc` looks like this:

[source,asiidoc]
----
=== Show a picture 

image::./images1.jpg[]
----

The asciidoc document `test2.adoc` looks like this:

[source,asiidoc]
----
:imagesdir: ./../../../images2

=== Show a picture 

image::images2.jpg[]
----

       
*What is the output?*

Now:

----

/tmp/asciidoctor-editor-gen/
    /myproject_6414940450661
        /images2/
            image2.jpg
        /src/doc/asciidoc
            images1/
              image1.jpg
              diagram1.png
              diagram2.svg
         1234asdfsdfsf_test1_hidden_editor_file.adoc
         1234asdfsdfsf_test1_internal.httml
         52323safdsdfs_test2.hidden_editor_file.adoc
         52323safdsdfs_test2_internal.httml

----       

Planned:
      
----

/tmp/asciidoctor-editor-gen/
    /myproject_6414940450661
        /images_directory          
            123456112A_image1.jpg
            898716112A_image2.jpg
            d23232323_diagram1.png
            d23232323_diagram2.svg
     1234asdfsdfsf_test1_hidden_editor_file.adoc
     1234asdfsdfsf_test1_internal.httml
     52323safdsdfs_test2.hidden_editor_file.adoc
     52323safdsdfs_test2_internal.httml

----    

Or: images out dir <=> new transformed dir!
      
----

/tmp/asciidoctor-editor-gen/
    /myproject_6414940450661
        /images_outdir          
            123456112A_image1.jpg
            898716112A_image2.jpg
            d23232323_diagram1.png
            d23232323_diagram2.svg
     1234asdfsdfsf_test1_hidden_editor_file.adoc
     1234asdfsdfsf_test1_internal.httml
     52323safdsdfs_test2.hidden_editor_file.adoc
     52323safdsdfs_test2_internal.httml

----       

So we must always 
- convert relative pathes inside imagesdir to absolute ones
  (just check images dir attribute before rendering. check if starting
   with ./ if so, convert to absolute path before calling asciidoctor)
- fetch absolute image pathes from generated HTML
- create a new (flat) corresponding file 
- copy to the flat locaton
- change html to use flat variant
    
Advantages:
- imagesoutdir (`asciidoctor-diagrams`)  and `imagesdir` are same and there are no
  unwanted (genarated) diagram images inside the eclipse project
- one file for same image (no accidently duplicated files because of relative file pathes)
- 
       
       
       
Or: images out dir tmp, use absolute pathes (linux: firefox + chromium works without same origin problems)
so no image copy necessary, we only change html. 

every file not found in html output, we change to imageoutputdir...      
----

/tmp/asciidoctor-editor-gen/
    /myproject_6414940450661
        /images_outdir          
            diag__image1.jpg
            diag__image2.jpg
     1234asdfsdfsf_test1_hidden_editor_file.adoc
     1234asdfsdfsf_test1_internal.httml
     52323safdsdfs_test2.hidden_editor_file.adoc
     52323safdsdfs_test2_internal.httml

----     
